<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - velva.clip</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================================== */
        /* === ULTIMATE PROFESSIONAL CSS FOR DASHBOARD - OPUS CLIP WHITE AND BLACK THEME === */
        /* ==================================== */

        /* Root variables - the heart of consistency */
        :root {
            --bg-color: #ffffff; /* Le fond devient blanc */
            --glass-bg: rgba(248, 252, 252, 0.8); /* Fond des cartes en blanc cassé semi-transparent */
            --glass-bg-hover: rgba(248, 252, 248, 0.95); /* Plus opaque au survol */
            --border-color: rgba(0, 0, 0, 0.1); /* Bordures subtiles en noir */
            --primary-accent: #8b5cf6; /* Muted purple for primary accent */
            --secondary-accent: #a78bfa; /* Lighter purple for secondary accent */
            --tertiary-accent: #000000; /* Le noir pour les éléments qui étaient en blanc */
            --font-color-main: #000000; /* Le texte principal devient noir */
            --font-color-light: #555555; /* Le texte secondaire devient gris foncé */
            --danger-color: #ef4444; /* Standard red (can keep for danger) */
            --danger-color-dark: #dc2626;
            --notification-bg: #ff7f00; /* Orange for notifications */
            --notification-glow: rgba(255, 127, 0, 0.5);

            /* Gradients adapted to black/white */
            --gradient-main: linear-gradient(90deg, var(--primary-accent) 0%, var(--secondary-accent) 100%);
            --gradient-hover: linear-gradient(90deg, var(--secondary-accent) 0%, var(--primary-accent) 100%);
            --gradient-shimmer: linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.1) 30%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.1) 70%, rgba(0,0,0,0) 100%);
            
            /* Shadows are mostly subtle, based on dark tones */
            --shadow-xsm: 0 1px 2px 0 rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -4px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 8px 10px -6px rgba(0, 0, 0, 0.4);
            
            --border-radius-xl: 20px;
            --border-radius-lg: 12px;
            --border-radius-md: 8px;
            --border-radius-sm: 4px;

            --transition-duration: 0.3s;
            --transition-ease: cubic-bezier(0.4, 0, 0.2, 1); /* Standard ease-in-out */
        }

        /* --- Base & Global Styles --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--font-color-main);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background (Aurora effect - more subtle) */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(at 15% 20%, rgba(60, 60, 60, 0.1) 0px, transparent 50%),
                radial-gradient(at 80% 35%, rgba(80, 80, 80, 0.1) 0px, transparent 50%),
                radial-gradient(at 25% 75%, rgba(50, 50, 50, 0.08) 0px, transparent 50%),
                radial-gradient(at 70% 80%, rgba(70, 70, 70, 0.12) 0px, transparent 50%);
            z-index: -1;
            animation: aurora 25s linear infinite;
        }
        @keyframes aurora {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Fade-in and subtle slide-up on load */
        @keyframes fadeInSlideUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-on-load {
            animation: fadeInSlideUp 0.8s var(--transition-ease) forwards;
            opacity: 0;
        }

        /* --- Layout & Container --- */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            flex-grow: 1;
            z-index: 1;
            position: relative;
        }

        /* --- Typography & Headings --- */
        h1, h2, h3 {
            font-weight: 700;
            line-height: 1.2;
            color: var(--font-color-main);
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 0.5rem;
            text-align: center;
            letter-spacing: -0.03em;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        h2 {
            font-size: 2.2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.8rem;
            margin-bottom: 1.8rem;
            margin-top: 4rem;
            letter-spacing: -0.02em;
        }
        h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        p {
            color: var(--font-color-light);
            margin-bottom: 1rem;
            font-weight: 300;
        }
        strong {
            font-weight: 600;
            color: var(--font-color-main);
        }
        pre {
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            color: var(--font-color-light);
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 0.9em;
        }

        /* --- Welcome Message & Logout --- */
        .welcome-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2.5rem;
            gap: 1.5rem;
        }
        .welcome-text {
            flex-grow: 1;
            color: var(--font-color-light);
            font-size: 1.1rem;
            font-weight: 400;
        }
        .welcome-text strong {
            color: var(--font-color-main);
        }
        .welcome-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .welcome-actions a {
            color: var(--tertiary-accent);
            text-decoration: none;
            font-weight: 600;
            transition: color var(--transition-duration) var(--transition-ease), transform 0.15s var(--transition-ease);
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        .welcome-actions a:hover {
            color: var(--secondary-accent);
            transform: translateY(-2px);
        }

        /* --- Notification Icon --- */
        .notification-icon {
            position: relative;
            font-size: 1.5rem;
            color: var(--font-color-light);
            cursor: pointer;
            transition: color var(--transition-duration) var(--transition-ease), transform var(--transition-duration) var(--transition-ease);
            padding: 5px;
        }
        .notification-icon:hover {
            color: var(--tertiary-accent);
            transform: scale(1.1) rotate(5deg);
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--notification-bg);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 50%;
            min-width: 22px;
            height: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 8px var(--notification-glow);
            border: 1px solid rgba(255,255,255,0.2);
            animation: pulse-notification 2s infinite ease-in-out;
            transform-origin: center;
        }
        @keyframes pulse-notification {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        /* Hide badge if no notifications */
        .notification-badge.hidden {
            display: none;
        }

        /* --- Buttons (Generalized for reuse) --- */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.8rem 1.8rem;
            border-radius: var(--border-radius-lg);
            text-decoration: none;
            font-weight: 600;
            font-size: 1.05rem;
            transition: all var(--transition-duration) var(--transition-ease);
            cursor: pointer;
            border: none;
            text-align: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        /* Shimmer effect for primary buttons */
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-shimmer);
            transition: all 0.7s cubic-bezier(0.2, 0.8, 0.2, 1);
            opacity: 0;
            z-index: -1;
        }
        .btn:hover::before {
            left: 100%;
            opacity: 1;
        }
        .btn-primary {
            background: var(--gradient-main);
            color: #000;
            box-shadow: var(--shadow-md);
            background-size: 200% auto;
        }
        .btn-primary:hover {
            background-position: right center;
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        .btn-primary:active {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }
        .btn-danger {
            background-color: var(--danger-color);
            color: #fff;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--danger-color-dark);
            font-size: 0.9rem;
            padding: 0.7rem 1.4rem;
        }
        .btn-danger:hover {
            background-color: var(--danger-color-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        .btn-danger:active {
            transform: translateY(0);
        }

        /* --- Process Cards (The main content blocks) --- */
        .process-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-xl);
            margin-bottom: 2.5rem;
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            transition: transform var(--transition-duration) var(--transition-ease), 
                        box-shadow var(--transition-duration) var(--transition-ease), 
                        background var(--transition-duration) var(--transition-ease),
                        border-color var(--transition-duration) var(--transition-ease);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        .process-card::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: var(--border-radius-xl);
            padding: 1px;
            background: linear-gradient(45deg, rgba(255,255,255,0.3), rgba(200,200,200,0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            z-index: 0;
            opacity: 0;
            transition: opacity var(--transition-duration) var(--transition-ease);
        }
        .process-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 30px 40px -8px rgba(0,0,0,0.3), 0 12px 15px -6px rgba(0,0,0,0.3);
            background: var(--glass-bg-hover);
            border-color: rgba(255, 255, 255, 0.15);
        }
        .process-card:hover::before {
            opacity: 1;
        }
        .process-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.8rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
        }
        .process-header > div {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }
        .process-header strong {
            font-weight: 700;
            color: var(--font-color-main);
            font-size: 1.2rem;
        }
        .process-header .url {
            color: var(--font-color-light);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .process-header .delete-btn-wrapper {
            flex-shrink: 0;
            margin-left: 1.5rem;
        }
        .live-log-container {
            margin-top: 2rem;
        }
        /* --- Clips Grid --- */
        .clips-grid {
            display: grid;
            /* Reverted to original vertical layout */
            grid-template-columns: 1fr;
            max-width: 700px;
            margin: 0 auto;
            gap: 2rem;
            padding-top: 0.5rem;
        }

        /* --- Clip Card Styling --- */
        .clip-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            /* Reverted to original grid layout for clips */
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-duration) var(--transition-ease), box-shadow var(--transition-duration) var(--transition-ease);
            overflow: hidden;
            position: relative;
            cursor: default;
        }
        .clip-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-md);
        }
        /* Video wrapper for the new play functionality */
        .video-wrapper {
            position: relative;
            width: 100%;
            /* Reverted to original aspect ratio for clips */
            aspect-ratio: 9/16;
            background-color: #000;
            border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
            overflow: hidden;
            cursor: pointer;
        }

        .clip-card video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background-color: #000;
            display: block;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: var(--border-radius-lg) 0 0 var(--border-radius-lg);
        }
        /* Thumbnail and Play button overlay */
        .video-thumbnail-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s ease;
        }

        .play-icon {
            font-size: 3em; /* Reduced icon size */
            color: rgba(255, 255, 255, 0.9);
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            padding: 0.4em;
            transition: all 0.3s ease;
            z-index: 10;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .video-wrapper:hover .play-icon {
            transform: scale(1.1);
        }
        .video-wrapper.is-playing .video-thumbnail-overlay {
            opacity: 0;
            pointer-events: none;
        }
        .video-wrapper.is-playing video {
            opacity: 1;
        }

        .clip-timer-overlay {
            position: absolute;
            top: 8px; /* Adjusted position */
            right: 8px; /* Adjusted position */
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 3px 6px; /* Reduced padding */
            border-radius: var(--border-radius-sm);
            font-size: 0.75em; /* Reduced font size */
            font-weight: 600;
            z-index: 11;
            display: flex;
            align-items: center;
            gap: 5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        .clip-timer-overlay i {
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
        }

        /* Clip Info Section */
        .clip-info {
            padding: 1.25rem; /* Reduced padding */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-grow: 1;
        }
        .clip-title {
            font-size: 1.3rem; /* Reduced font size */
            font-weight: 700;
            color: var(--font-color-main);
            margin-bottom: 0.6rem; /* Reduced margin */
            line-height: 1.3;
            /* Allow title to wrap without truncation */
            white-space: normal;
            overflow: visible;
            text-overflow: initial;
            word-break: break-word;
        }
        .clip-description-container {
            position: relative;
            margin-bottom: 1rem; /* Reduced margin */
            flex-grow: 1;
            padding-right: 25px; /* Space for the copy button */
        }
        .clip-description {
            font-size: 0.85rem; /* Reduced font size */
            color: var(--font-color-light);
            margin: 0; /* Override default paragraph margin */
            line-height: 1.4;
            /* Allow full description to be visible */
            display: block;
            -webkit-line-clamp: unset;
            -webkit-box-orient: unset;
            overflow: auto;
        }
        .copy-btn {
            position: absolute;
            top: -2px;
            right: 0;
            background: none;
            border: none;
            color: var(--font-color-light);
            cursor: pointer;
            font-size: 1em; /* Reduced icon size */
            transition: color 0.2s ease;
        }
        .copy-btn:hover {
            color: var(--primary-accent);
        }
        .copy-btn.copied {
            color: #44bd32; /* Green color for success */
        }
        .clip-actions {
            display: flex;
            gap: 1rem; /* Reduced gap */
            margin-top: auto;
            border-top: 1px solid var(--border-color);
            padding-top: 0.8rem; /* Reduced padding */
        }
        .clip-actions a {
            color: var(--secondary-accent);
            text-decoration: none;
            font-size: 0.88rem; /* Reduced font size */
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem; /* Reduced gap */
            transition: color var(--transition-duration) var(--transition-ease), transform 0.15s var(--transition-ease);
        }
        .clip-actions a:hover {
            color: var(--tertiary-accent);
            transform: translateX(4px);
        }
        .clip-actions a i {
            font-size: 1em;
        }
        /* New styling for the download button */
        .btn-download {
            background-color: var(--primary-accent);
            color: #ffffff;
            font-weight: 600;
            border-radius: var(--border-radius-md);
            padding: 0.6rem 1rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-download:hover {
            background-color: var(--secondary-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }


        /* --- No Jobs Message --- */
        .no-jobs {
            background: var(--glass-bg);
            backdrop-filter: blur(14px);
            padding: 3.5rem;
            text-align: center;
            color: var(--font-color-light);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-md);
            font-size: 1.15rem;
        }
        .no-jobs p {
            margin-bottom: 1.8rem;
        }
        .no-jobs a {
            color: var(--primary-accent);
            text-decoration: underline;
            font-weight: 600;
            transition: color var(--transition-duration) var(--transition-ease);
        }
        .no-jobs a:hover {
            color: var(--secondary-accent);
        }

        /* --- Flash Messages --- */
        .flash-message {
            padding: 1.1rem 1.6rem;
            margin-bottom: 1.8rem;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            border-left: 6px solid;
            box-shadow: var(--shadow-sm);
            font-size: 0.95rem;
        }
        .flash-message.success {
            background-color: rgba(68, 189, 50, 0.18);
            border-color: #44bd32;
            color: #44bd32;
        }
        .flash-message.error {
            background-color: rgba(235, 77, 75, 0.18);
            border-color: #eb4d4b;
            color: #eb4d4b;
        }
        .flash-message i {
            font-size: 1.4em;
            flex-shrink: 0;
        }
        
        /* Styles for the live progress preview */
        #live-progress-section {
            width: 100%;
            margin-bottom: 2.5rem;
            /* Small, centered video preview */
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }
        .live-progress-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-duration) var(--transition-ease);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .live-progress-card .process-header {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
            gap: 0.5rem;
        }
        .live-progress-card .process-header strong {
            font-size: 1.1rem;
        }
        .live-progress-card .url {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        .live-video-preview {
            width: 100%;
            aspect-ratio: 16/9; /* Set aspect ratio to horizontal */
            background-color: #000;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            position: relative;
        }
        .live-video-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .live-progress-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            color: #fff;
            padding: 1rem;
            text-align: center;
        }
        /* Adjusted the live progress text element and its container */
        #live-progress-text-element {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            text-shadow: 0 1px 4px rgba(0,0,0,0.5);
            display: none; /* Hide the original text element */
        }
        #live-progress-bar-container {
            width: 80%;
            height: 30px; /* **Make the bar bigger** */
            background: rgba(255,255,255,0.2);
            border-radius: 0; /* **Remove border radius for rectangle shape** */
            overflow: hidden;
            position: relative; /* Add relative positioning */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #live-progress-bar-fill {
            height: 100%;
            background: #44bd32; /* **Change color to brilliant green** */
            transition: width 0.3s ease-in-out;
            border-radius: 0; /* **Remove border radius** */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        #progress-percentage-text {
            position: relative;
            z-index: 2; /* Ensure the text is on top of the bar */
            font-weight: 600;
            color: #fff;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1024px) {
            .process-card {
                padding: 2rem;
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            h1 {
                font-size: 2.5rem;
            }
            h2 {
                font-size: 1.8rem;
            }
            .welcome-section {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: 1rem;
                margin-bottom: 2rem;
                gap: 1.5rem;
            }
            .welcome-actions {
                width: 100%;
                justify-content: flex-end;
            }
            .btn-primary {
                width: 100%;
                padding: 0.7rem 1.5rem;
                font-size: 1rem;
            }
            .process-card {
                padding: 1.5rem;
                border-radius: var(--border-radius-lg);
            }
            .process-header {
                flex-direction: column;
                align-items: flex-start;
                padding-bottom: 1rem;
                margin-bottom: 1rem;
                gap: 0.8rem;
            }
            .process-header .delete-btn-wrapper {
                margin-left: 0;
                width: 100%;
                margin-top: 0.8rem;
            }
            .process-header .btn-danger {
                width: 100%;
                font-size: 0.95rem;
                padding: 0.7rem 1.2rem;
            }
            .clips-grid {
                grid-template-columns: 1fr;
                max-width: none;
                gap: 1.5rem;
            }
            .clip-card {
                grid-template-columns: 1fr;
            }
            .video-wrapper {
                /* Reverted aspect ratio for clips on mobile */
                aspect-ratio: 9/16;
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
            .clip-card video {
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
            .clip-info {
                padding: 0.8rem 1rem;
            }
            .clip-info h3 {
                font-size: 1rem;
            }
            .clip-info p {
                font-size: 0.85rem;
            }
            .clip-description-container {
                padding-right: 0;
            }
            .clip-actions {
                flex-direction: row;
                justify-content: space-around;
                gap: 0.5rem;
                padding-top: 0.8rem;
            }
            .clip-actions a {
                font-size: 0.88rem;
                gap: 0.4rem;
            }
            .clip-card::after {
                font-size: 3em;
            }
            .clip-timer-overlay {
                font-size: 0.75em;
                padding: 3px 6px;
            }
            /* Reverted live preview aspect ratio on mobile for proper fit */
            #live-progress-section .live-video-preview {
                aspect-ratio: 9/16;
            }
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 2.2rem;
            }
            h2 {
                font-size: 1.6rem;
            }
            .process-card {
                padding: 1rem;
            }
            .clip-info {
                padding: 0.75rem;
            }
            .clip-actions {
                flex-direction: column;
                gap: 0.6rem;
            }
            .flash-message {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            /* Logo adjustments for mobile */
            .logo { 
                height: 32px;
                margin-right: auto;
            }
            .logo img {
                height: 100%;
                width: auto;
            }
            .logo svg {
                display: none;
            }
        }
        
        /* --- Styles for the Header and Navigation --- */
        header {
            background: #ffffff;
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Corrected Logo Styles for proper sizing and alignment */
        .logo {
            display: flex;
            align-items: center;
            height: 40px; /* Standard height for a logo in a navbar */
            margin-right: auto; /* Pushes the logo to the left and other elements to the right */
        }
        
        .logo img {
            height: 100%;
            width: auto;
            display: block;
        }

        .logo svg {
            display: none;
        }

        .nav-links {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-links a {
            color: var(--font-light);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--tertiary-accent);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .btn-login {
            background-color: transparent;
            border: 1px solid var(--border-color);
            color: var(--font-color-main);
        }

        .btn-login:hover {
            background-color: var(--border-color);
        }

        .btn-signup {
            background: var(--gradient-main);
            color: #000;
            border: none;
        }

        .btn-signup:hover {
            background: var(--gradient-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .hamburger { display: none; }
        
        /* Styles for the new position of the live progress bar */
        #live-progress-section {
            width: 100%;
            margin-bottom: 2.5rem; /* Space below the card */
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }

        .live-progress-card {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-duration) var(--transition-ease);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .live-progress-card .process-header {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
            gap: 0.5rem;
        }

        .live-progress-card .process-header strong {
            font-size: 1.1rem;
        }

        .live-progress-card .url {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .live-video-preview {
            width: 100%;
            /* Set aspect ratio to horizontal */
            aspect-ratio: 16/9;
            background-color: #000;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            position: relative;
        }

        .live-video-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .live-progress-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            color: #fff;
            padding: 1rem;
            text-align: center;
        }

        #live-progress-text-element {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            text-shadow: 0 1px 4px rgba(0,0,0,0.5);
            display: none;
        }

        #live-progress-bar-container {
            width: 80%;
            height: 30px; /* **Make the bar bigger** */
            background: rgba(255,255,255,0.2);
            border-radius: 0; /* **Remove border radius for rectangle shape** */
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #live-progress-bar-fill {
            height: 100%;
            background: #44bd32; /* **Change color to brilliant green** */
            transition: width 0.3s ease-in-out;
            border-radius: 0; /* **Remove border radius** */
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        
        #progress-percentage-text {
            position: relative;
            z-index: 2; /* Ensure the text is on top of the bar */
            font-weight: 600;
            color: #fff;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        @media (max-width: 768px) {
            #live-progress-section {
                width: 100%;
                max-width: none;
                margin-left: auto;
                margin-right: auto;
            }
            .clips-grid {
                grid-template-columns: 1fr;
                max-width: none;
                gap: 1.5rem;
            }
            .clip-card {
                grid-template-columns: 1fr;
            }
            .video-wrapper {
                /* Reverted aspect ratio for clips on mobile */
                aspect-ratio: 9/16;
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
            .video-wrapper video {
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
            .clip-info {
                padding: 0.8rem 1rem;
            }
            .clip-info h3 {
                font-size: 1rem;
            }
            .clip-info p {
                font-size: 0.85rem;
            }
            .clip-description-container {
                padding-right: 0;
            }
            .clip-actions {
                flex-direction: row;
                justify-content: space-around;
                gap: 0.5rem;
                padding-top: 0.8rem;
            }
            .clip-actions a {
                font-size: 0.88rem;
                gap: 0.4rem;
            }
            .clip-card::after {
                font-size: 3em;
            }
            .clip-timer-overlay {
                font-size: 0.75em;
                padding: 3px 6px;
            }
            /* Reverted live preview aspect ratio on mobile for proper fit */
            #live-progress-section .live-video-preview {
                aspect-ratio: 9/16;
            }
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 2.2rem;
            }
            h2 {
                font-size: 1.6rem;
            }
            .process-card {
                padding: 1rem;
            }
            .clip-info {
                padding: 0.75rem;
            }
            .clip-actions {
                flex-direction: column;
                gap: 0.6rem;
            }
            .flash-message {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }
            /* Logo adjustments for mobile */
            .logo { 
                height: 32px;
                margin-right: auto;
            }
            .logo img {
                height: 100%;
                width: auto;
            }
            .logo svg {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="{{ url_for('index') }}" class="logo">
                <img src="{{ url_for('static', filename='images/footer-logo.png') }}" alt="Velva.clip Logo">
            </a>
            <div class="nav-links">
                <a href="#memberships">Abonnements</a>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dashboard') }}">Dashboard</a>
                {% endif %}
            </div>
            <div class="nav-actions">
                {% if current_user.is_authenticated %}
                    <div class="notification-icon">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge {% if not has_notifications %}hidden{% endif %}" id="notification-count">{{ notification_count }}</span>
                    </div>
                    <a href="{{ url_for('logout') }}" class="btn btn-login"><i class="fas fa-sign-out-alt"></i> Logout</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn btn-login"><i class="fas fa-sign-in-alt"></i> Log In</a>
                    <a href="{{ url_for('signup') }}" class="btn btn-signup"><i class="fas fa-user-plus"></i> Sign Up</a>
                {% endif %}
            </div>
            <div class="hamburger">
                <div class="line"></div><div class="line"></div><div class="line"></div>
            </div>
        </nav>
    </header>

    <div class="container animate-on-load">
        <h1>Dashboard</h1>
        <div class="welcome-section">
            <p class="welcome-text">
                Welcome back, <strong>{{ current_user.username }}</strong>!
                {% if current_user_tier == 'free' %}
                    <span style="font-size: 0.9em; color: var(--font-color-light);"> (Free Plan - {{ current_clip_count }}/5 clips today)</span>
                {% else %}
                    <span style="font-size: 0.9em; color: var(--secondary-accent);"> ({{ current_user_tier.capitalize() }} Plan)</span>
                {% endif %}
            </p>
            <div class="welcome-actions">
                <a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {% if category == 'success' %}<i class="fas fa-check-circle"></i>{% else %}<i class="fas fa-exclamation-circle"></i>{% endif %}
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div style="margin-bottom: 2.5rem;">
            <a href="{{ url_for('index') }}" class="btn btn-primary"><i class="fas fa-plus" style="margin-right: 8px;"></i> Create New Clips</a>
        </div>
        
        <div id="live-progress-section" {% if not live_process %}style="display: none;"{% endif %}>
            <div class="live-progress-card animate-on-load">
                <div class="process-header">
                    <div>
                        <strong>Video in progress...</strong><br>
                        <span class="url" id="processing-video-url">{{ live_process.source_url if live_process else "" }}</span>
                    </div>
                    <div class="delete-btn-wrapper">
                        <button class="btn btn-danger" id="cancel-processing-btn">
                            <i class="fas fa-times-circle"></i> Cancel
                        </button>
                    </div>
                </div>
                <div class="live-video-preview">
                    <img id="live-video-thumbnail" src="{{ live_process_thumbnail_url or '#' }}" alt="Video Thumbnail">
                    <div class="live-progress-overlay">
                        <div id="live-progress-text-element" style="display: none;"></div>
                        <div id="live-progress-bar-container">
                            <div id="live-progress-bar-fill" style="width: 0%;"></div>
                            <span id="progress-percentage-text">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <h2>Your Past Jobs</h2>

        {% if processes %}
            {% for process in processes %}
            <div class="process-card animate-on-load" data-session-id="{{ process.session_id }}" style="animation-delay: {{ loop.index0 * 0.1 }}s;">
                <div class="process-header">
                    <div>
                        <strong>Job from:</strong> {{ process.created_at.strftime('%Y-%m-%d %H:%M') }}<br>
                        <span class="url" title="{{ process.source_url }}">Source: {{ process.source_url }}</span>
                    </div>
                    <div class="delete-btn-wrapper">
                        <button class="btn btn-danger delete-project-btn" data-session-id="{{ process.session_id }}">
                            <i class="fas fa-trash-alt"></i> Delete Project
                        </button>
                    </div>
                </div>

                {% if process.clips %}
                <div class="clips-grid">
                    {% for clip in process.clips %}
                    <div class="clip-card animate-on-load" style="animation-delay: {{ loop.index0 * 0.05 + 0.2 }}s;">
                        <div class="video-wrapper">
                             <video controls playsinline preload="metadata" poster="{{ url_for('serve_thumbnail', session_id=process.session_id, filename='thumbnail.jpg') }}">
                                <source src="{{ url_for('download_clip', session_id=process.session_id, filename=clip.filename) }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                             <div class="video-thumbnail-overlay">
                                <i class="fas fa-play-circle play-icon"></i>
                            </div>
                        </div>
                        <div class="clip-info">
                            <div class="clip-timer-overlay">
                                <i class="fas fa-clock"></i> <span class="clip-duration">0:00</span>
                            </div>
                            <h3 class="clip-title">{{ clip.title }}</h3>
                            <div class="clip-description-container">
                                <p class="clip-description">{{ clip.description }}</p>
                                <button class="copy-btn" title="Copy description"><i class="fas fa-copy"></i></button>
                            </div>
                            <div class="clip-actions">
                                <a href="{{ url_for('download_clip', session_id=process.session_id, filename=clip.filename) }}" download class="btn-download"><i class="fas fa-download"></i> Download</a>
                                <a href="{{ url_for('uploader_web', session_id=process.session_id) }}?video={{clip.filename}}" target="_blank"><i class="fas fa-upload"></i> Upload</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="no-jobs animate-on-load" style="animation-delay: 0.2s;">
                    <p>No clips were generated for this job, or it is still in progress.</p>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <div class="no-jobs animate-on-load" style="animation-delay: 0.2s;">
                <p>You haven't processed any videos yet. <a href="{{ url_for('index') }}">Let's create some!</a></p>
            </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Helper to convert CSS variable to milliseconds for JS setTimeout
            function var_to_ms(cssVarName) {
                const style = getComputedStyle(document.documentElement);
                const value = style.getPropertyValue(cssVarName);
                if (value.endsWith('s')) {
                    return parseFloat(value) * 1000;
                }
                return parseFloat(value); // Assuming 'ms' or no unit means milliseconds
            }

            const videoElements = document.querySelectorAll('.clip-card video');
            videoElements.forEach(video => {
                video.addEventListener('loadedmetadata', () => {
                    const duration = video.duration;
                    const minutes = Math.floor(duration / 60);
                    const seconds = Math.floor(duration % 60);
                    const formattedSeconds = seconds < 10 ? '0' + seconds : seconds;
                    const formattedDuration = `${minutes}:${formattedSeconds}`;
                    
                    const timerOverlay = video.closest('.clip-card').querySelector('.clip-duration');
                    if (timerOverlay) {
                        timerOverlay.textContent = formattedDuration;
                    }
                });
                if (video.readyState >= 1) {
                    const duration = video.duration;
                    if (isFinite(duration) && duration > 0) {
                        const minutes = Math.floor(duration / 60);
                        const seconds = Math.floor(duration % 60);
                        const formattedSeconds = seconds < 10 ? '0' + seconds : seconds;
                        const formattedDuration = `${minutes}:${formattedSeconds}`;
                        const timerOverlay = video.closest('.clip-card').querySelector('.clip-duration');
                        if (timerOverlay) {
                            timerOverlay.textContent = formattedDuration;
                        }
                    }
                }
            });

            // New logic for click-to-play functionality
            const videoWrappers = document.querySelectorAll('.video-wrapper');
            videoWrappers.forEach(wrapper => {
                const video = wrapper.querySelector('video');
                const overlay = wrapper.querySelector('.video-thumbnail-overlay');

                wrapper.addEventListener('click', () => {
                    // Check if the video is already playing
                    if (video.paused) {
                        // Pause all other videos before playing the current one
                        videoElements.forEach(otherVideo => {
                            if (otherVideo !== video && !otherVideo.paused) {
                                otherVideo.pause();
                                otherVideo.closest('.video-wrapper').classList.remove('is-playing');
                            }
                        });

                        // Play the video and hide the overlay
                        video.play();
                        wrapper.classList.add('is-playing');
                    } else {
                        // Pause the video and show the overlay
                        video.pause();
                        wrapper.classList.remove('is-playing');
                    }
                });
            });

            // New logic to handle the "Copy to Clipboard" buttons
            document.querySelectorAll('.copy-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    event.stopPropagation(); // Prevent the video from playing when the button is clicked
                    const descriptionText = event.currentTarget.previousElementSibling.textContent;
                    
                    navigator.clipboard.writeText(descriptionText).then(() => {
                        const originalIcon = button.innerHTML;
                        button.innerHTML = '<i class="fas fa-check"></i>';
                        button.classList.add('copied');
                        setTimeout(() => {
                            button.innerHTML = originalIcon;
                            button.classList.remove('copied');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                });
            });

            // --- Delete Project Functionality ---
            document.querySelectorAll('.delete-project-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const sessionId = event.target.dataset.sessionId;
                    if (!sessionId) {
                        console.error("Session ID not found for delete button.");
                        return;
                    }

                    const confirmDeletion = confirm("Are you sure you want to delete this project and all its clips? This action cannot be undone.");
                    if (!confirmDeletion) {
                        return;
                    }

                    try {
                        const response = await fetch(`/delete_process/${sessionId}`, {
                            method: 'DELETE',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            }
                        });

                        const data = await response.json();

                        if (response.ok) {
                            const processCard = document.querySelector(`.process-card[data-session-id="${sessionId}"]`);
                            if (processCard) {
                                processCard.style.opacity = '0';
                                processCard.style.transform = 'translateY(20px)';
                                setTimeout(() => {
                                    processCard.remove();
                                    if (document.querySelectorAll('.process-card').length === 0) {
                                        const pastJobsSection = document.querySelector('h2');
                                        let noJobsDiv = document.querySelector('.no-jobs');
                                        if (!noJobsDiv) {
                                            noJobsDiv = document.createElement('div');
                                            noJobsDiv.className = 'no-jobs animate-on-load';
                                            noJobsDiv.innerHTML = '<p>You haven\'t processed any videos yet. <a href="{{ url_for('index') }}">Let\'s create some!</a></p>';
                                            pastJobsSection.insertAdjacentElement('afterend', noJobsDiv);
                                            noJobsDiv.style.animation = 'none';
                                            void noJobsDiv.offsetWidth;
                                            noJobsDiv.style.animation = null;
                                        }
                                    }
                                }, var_to_ms('--transition-duration'));
                            }
                        } else {
                            alert(`Error: ${data.message || 'Could not delete project.'}`);
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        alert('An error occurred while trying to delete the project. Please try again.');
                    }
                });
            });

            const notificationCountElement = document.getElementById('notification-count');
            let currentNotificationCount = 3;
            if (notificationCountElement) {
                notificationCountElement.textContent = currentNotificationCount;
                if (currentNotificationCount === 0) {
                    notificationCountElement.classList.add('hidden');
                } else {
                    notificationCountElement.classList.remove('hidden');
                }
            }
            
            // --- New logic to handle live progress tracking ---
            const liveSessionId = "{{ live_session_id }}";
            const liveProcessStatus = "{{ live_process.status if live_process else '' }}";
            const liveProcessUrl = "{{ live_process.source_url if live_process else '' }}";

            // Only proceed if a live session is active AND its status is 'processing'
            if (liveSessionId && liveProcessStatus === 'processing' && document.querySelector(`#live-progress-section`)) {
                const liveProgressSection = document.getElementById('live-progress-section');
                liveProgressSection.style.display = 'block';

                document.getElementById('processing-video-url').textContent = liveProcessUrl;

                const liveProgressTextElement = document.getElementById('live-progress-text-element');
                const liveProgressBarFill = document.getElementById('live-progress-bar-fill');
                const progressPercentageText = document.getElementById('progress-percentage-text'); // Get the new element

                const eventSource = new EventSource(`/logs/${liveSessionId}`);
                
                eventSource.onmessage = function(e) {
                    const message = e.data;
                    console.log("Received SSE message:", message);
                    
                    if (message.startsWith("PROGRESS:")) {
                        const progress = parseInt(message.split(':')[1]);
                        liveProgressBarFill.style.width = progress + '%';
                        progressPercentageText.textContent = `${progress}%`; // Update the new text element
                    } else if (message.includes("PROCESSING_COMPLETE:") || message.includes("PROCESSING_ERROR:") || message.includes("STREAM_TERMINATED")) {
                        eventSource.close();
                        // Remove the session ID from local storage to prevent future refreshes
                        sessionStorage.removeItem('live_session_id');
                        liveProgressTextElement.textContent = "Processing finished. Reloading page...";
                        setTimeout(() => window.location.href = "{{ url_for('dashboard') }}", 1000);
                    } else {
                        console.log(message);
                    }
                };

                eventSource.onerror = function(e) {
                    console.error("EventSource failed:", e);
                    eventSource.close();
                    sessionStorage.removeItem('live_session_id');
                    liveProgressTextElement.textContent = "Connection lost. Please reload the page.";
                };

                document.getElementById('cancel-processing-btn').addEventListener('click', async () => {
                    const confirmCancel = confirm("Are you sure you want to cancel this process?");
                    if (confirmCancel) {
                         try {
                            const response = await fetch(`/delete_process/${liveSessionId}`, {
                                method: 'DELETE',
                                headers: { 'Content-Type': 'application/json' }
                            });
                            if (response.ok) {
                                alert("Process cancelled successfully.");
                                sessionStorage.removeItem('live_session_id');
                                window.location.reload();
                            } else {
                                alert("Failed to cancel process.");
                            }
                        } catch (error) {
                            console.error("Cancel error:", error);
                            alert("An error occurred while trying to cancel the process.");
                        }
                    }
                });
            } else {
                // If there's no live session on page load, make sure the progress section is hidden.
                 document.getElementById('live-progress-section').style.display = 'none';
            }
        });
    </script>
</body>
</html>